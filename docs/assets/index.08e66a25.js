var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(t,o,r)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,c=(e,t)=>{for(var o in t||(t={}))a.call(t,o)&&s(e,o,t[o]);if(r)for(var o of r(t))n.call(t,o)&&s(e,o,t[o]);return e};import{u as i,r as l,V as m,a as u,R as d,b as p,S as h,C as E,c as f,M as g,O as y,P as w,d as M,D as v,e as x,s as b,f as S,E as k,g as L,h as R,i as C}from"./vendor.f5c9e70e.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const P={position:[0,0,0],velocity:[0,0,0],rotation:[0,0,0],mousePosition:[0,0,0],controls:{up:!1,down:!1,left:!1,right:!1,mouse:!1},isUnderWater:!0,uuid:"",cannonApi:null},z=e=>e*(Math.PI/180),A=e=>e/(1+Math.abs(e)),F=e=>d.createElement("meshPhysicalMaterial",{attach:"material",flatShading:!1,specular:"#eff41c",roughness:.7,reflectivity:1,metalness:1,clearcoat:1,clearcoatRoughness:.2,color:e.color||"purple"}),G=e=>{const t=l.exports.useRef(),o=l.exports.useRef(),r=l.exports.useRef();return console.log("Tail"),u((e=>{const{velocity:a,position:n}=P,[s,c,i]=a,[l,m,u]=n,d=z(Math.sin(Math.abs(c)+Math.abs(m)+Math.abs(s)+Math.abs(l)+4*e.clock.getElapsedTime()));t.current.rotation.set(0,10*d,0),o.current.rotation.set(0,25*d,0),r.current.rotation.set(0,25*d,0)})),d.createElement("group",{ref:t},d.createElement(p,{args:[1,.75,.6],position:[-.5,.05,0],radius:.2,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(F,{color:e.color})),d.createElement("group",{ref:o,position:[-1,0,0]},d.createElement(p,{args:[.6,.6,.3],position:[-.1,0,0],radius:.05,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(F,{color:e.color})),d.createElement("group",{ref:r,position:[-.4,0,0]},d.createElement(p,{args:[.75,.4,.1],position:[-.1,.15,0],radius:.05,smoothness:4,rotation:[0,0,-10],receiveShadow:!0,castShadow:!0},d.createElement(F,{color:e.color})),d.createElement(p,{args:[.75,.4,.1],position:[-.1,-.15,0],radius:.05,smoothness:4,rotation:[0,0,10],receiveShadow:!0,castShadow:!0},d.createElement(F,{color:e.color})))))},O=e=>{const r=l.exports.useRef(),a=new m;return u((t=>{const[o,n,s]=P.velocity,c=a.set(A(-.1*n),.1*A(-1*n)+.5,0);r.current.setRotationFromAxisAngle(c.normalize(),e.mirror?-10:.5)})),d.createElement("group",(n=c({},e),t(n,o({ref:r}))),d.createElement(h,{position:[0,0,0],args:[.3],receiveShadow:!0,castShadow:!0},d.createElement(F,{translate:[0,10,.25],attach:"material",color:"#f3f3f3"})),d.createElement(h,{position:[0,0,.25],args:[.1],receiveShadow:!0,castShadow:!0},d.createElement(F,{translate:[0,10,.25],attach:"material",color:"black"})));var n},I=e=>{const[t,o]=i((()=>c({mass:1,position:[0,0,0],linearDamping:.75,linearFactor:[1,1,0],angularFactor:[1,1,0]},e))),r=l.exports.useRef(),a=l.exports.useRef(),n=new m;return console.log("Player"),l.exports.useLayoutEffect((()=>{P.uuid=t.current.uuid,P.cannonApi=o,console.count("subscribed");const e=o.velocity.subscribe((e=>{P.velocity=e})),r=o.position.subscribe((e=>{P.position=e})),a=o.rotation.subscribe((e=>{P.rotation=e}));return()=>{console.count("unsubscribed"),e(),r(),a()}}),[]),u((e=>{let{controls:t,isUnderWater:s,position:c,rotation:i,velocity:l,mousePosition:m}=P;const[u,d,p]=l,[h,E]=m,[f,g,y]=c;t.up&&s&&o.velocity.set(u,d+.2,p),t.down&&s&&o.velocity.set(u,d-.2,p),t.right&&s&&o.velocity.set(u+.5,d,p),t.left&&s&&o.velocity.set(u-.5,d,p),t.mouse&&s&&o.velocity.set(u+.1*h,d+.1*E,p),s&&d<-15&&o.velocity.set(u,-15,p),o.linearDamping.set(s?.75:.01),!s&&g>10.25&&o.applyImpulse([0,-.5,0],[0,0,0]),g<9&&!s&&(s=!0,console.log("not underwater"));const w=-10*Math.sin(Math.abs(d)+Math.abs(g)+Math.abs(u)+Math.abs(f)+4*e.clock.getElapsedTime()),M={y:z(180*(.5*A(.5*u)-.5)+w),z:z(90*A(.2*d))};o.rotation.set(0,M.y,M.z),r.current.setRotationFromAxisAngle(n.lerp(n.set(A(1*d),-1,0),.25),.5),a.current.setRotationFromAxisAngle(n.lerp(n.set(-1*A(1*d),1,0),.25),.5)})),d.createElement("group",{ref:t,name:"player"},d.createElement(p,{args:[1.5,1.2,.8],position:[.25,.1,0],radius:.2,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(F,{color:e.color})),d.createElement(p,{args:[.7,.5,.8],position:[.8,-.25,0],rotation:[0,0,0],radius:.2,smoothness:6,receiveShadow:!0,castShadow:!0},d.createElement(F,{color:e.color})),d.createElement(p,{args:[.5,.5,.05],position:[.25,.7,0],radius:.05,smoothness:4,rotation:[0,0,10],receiveShadow:!0,castShadow:!0},d.createElement(F,{color:e.color})),d.createElement(p,{ref:r,args:[.5,.1,.6],position:[-0,-.25,.4],radius:.05,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(F,{color:e.color})),d.createElement(p,{ref:a,args:[.5,.1,.6],position:[-0,-.25,-.4],radius:.05,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(F,{color:e.color})),d.createElement(p,{args:[.1,.1,.5],position:[1.11,-.3,0],radius:.05,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(F,{color:"#2e2929"})),d.createElement(O,{position:[.6,.1,.35]}),d.createElement(O,{position:[.6,.1,-.35],mirror:!0}),d.createElement(G,{color:e.color}))},j=e=>{const t=l.exports.useRef();l.exports.useRef(Math.random());const o=l.exports.useRef(!1),r=l.exports.useRef(new E("hsl(340, 88%, 45%)")),a=l.exports.useRef(new E("hsl(220, 87%, 30%)")),n=e.size||.5,[s,i]=f((()=>c({mass:.2*n,position:e.position,linearDamping:.7,linearFactor:[1,1,0],args:n,onCollide:e=>{o.current=!o.current}},e)));return u((({clock:e})=>{o.current?t.current.color.lerpHSL(a.current,.05):t.current.color.lerpHSL(r.current,.05)})),console.log("Ball"),d.createElement("group",{ref:s},d.createElement(h,{position:[0,0,0],args:[n],receiveShadow:!0,castShadow:!0},d.createElement(g,{ref:t,attach:"material",color:"hsl(340, 88%, 60%)",metalness:1,specular:"#0068b3",roughness:.7,reflectivity:.5,clearcoat:.5,clearcoatRoughness:.2})))},B="#4898e8",U="#164f6e",T=e=>(console.log("Sphere"),d.createElement(d.Fragment,null,d.createElement("sphereGeometry",{args:8*(.5*Math.random()+.75)}),d.createElement("meshLambertMaterial",{attach:"material",color:U}))),W=e=>{const t=l.exports.useRef(),o=l.exports.useRef(Array.from(Array(20)).map((e=>[Math.random()-.5,Math.random(),Math.random()]))),r=l.exports.useRef(new y),a=l.exports.useRef(o.current.map(((e,t)=>({positionX:100*e[0],positionZ:-100*e[1]+10,rotationY:e[2]}))),[]);return l.exports.useLayoutEffect((()=>{a.current.forEach(((e,o)=>{const{positionX:a,positionZ:n,rotationY:s}=e,c=.5*Math.random()+.5;r.current.position.set(a*(Math.random()+.5),-15,n*(Math.random()+.75)),r.current.scale.set(1,c,1),r.current.updateMatrix(),t.current.setMatrixAt(o,r.current.matrix)})),t.current.instanceMatrix.needsUpdate=!0}),[]),d.createElement("group",null,d.createElement("instancedMesh",{ref:t,args:[null,null,a.current.length]},d.createElement(T,null)),d.createElement("mesh",{position:[-30,-13,-100],rotation:[0,0,0]},d.createElement("icosahedronGeometry",{args:25}),d.createElement("meshLambertMaterial",{attach:"material",color:U})),d.createElement("mesh",{position:[-40,-15,-40],rotation:[10*Math.random(),10*Math.random(),10*Math.random()]},d.createElement("icosahedronGeometry",{args:15}),d.createElement("meshLambertMaterial",{attach:"material",color:U})),d.createElement("mesh",{position:[10,-10,-10],rotation:[10*Math.random(),10*Math.random(),10*Math.random()]},d.createElement("icosahedronGeometry",{args:5}),d.createElement("meshLambertMaterial",{attach:"material",color:U})),d.createElement("mesh",{position:[20,-10,-25],rotation:[10*Math.random(),10*Math.random(),10*Math.random()]},d.createElement("dodecahedronGeometry",{args:5}),d.createElement("meshLambertMaterial",{attach:"material",color:U})))},q=e=>(console.log("Pillar"),d.createElement(d.Fragment,null,d.createElement("coneGeometry",{args:[.5,15,7]}),d.createElement("meshLambertMaterial",{attach:"material",color:U}))),D=e=>{const t=l.exports.useRef(Array.from(Array(200)).map((e=>[Math.random()-.5,Math.random(),Math.random()]))),o=l.exports.useRef(),r=l.exports.useRef(new y),a=l.exports.useRef(t.current.map(((e,t)=>({positionX:100*e[0],positionZ:-100*e[1]+10,rotationY:e[2]}))),[]);return l.exports.useLayoutEffect((()=>{a.current.forEach(((e,t)=>{const{positionX:a,positionZ:n,rotationY:s}=e,c=.5*Math.random()+.5;r.current.position.set(a,15*c*.5-10,n>-1&&n<2?n:n-100*Math.random()),r.current.scale.set(1,c,1),r.current.rotation.set(0,s,0),r.current.updateMatrix(),o.current.setMatrixAt(t,r.current.matrix)})),o.current.instanceMatrix.needsUpdate=!0}),[]),d.createElement("instancedMesh",{ref:o,args:[null,null,a.current.length]},d.createElement(q,null))},N=e=>{const[t]=M((()=>c({rotation:[-Math.PI/2,0,0],position:[0,10,0],isTrigger:!0,onCollide:e=>{const{body:t}=e,o=P.uuid;t.uuid===o&&(P.isUnderWater=!0)}},e)));return console.log("Water surface"),d.createElement("mesh",{ref:t},d.createElement("planeBufferGeometry",{attach:"geometry",args:[1e3,1e3]}),d.createElement("meshBasicMaterial",{attach:"material",transparent:!0,opacity:0}))},X=e=>{const[t]=M((()=>c({rotation:[-Math.PI/-2,0,0],position:[0,10,-125],isTrigger:!0,onCollide:e=>{const{body:t,contact:o}=e,r=P.uuid,a=P.cannonApi,{velocity:n}=P;t.uuid===r&&(P.isUnderWater=!1,a.applyImpulse([.5*n[0],.25*n[1],0],[0,0,0]))}},e)));return console.log("Ceiling"),d.createElement("mesh",{ref:t,position:[0,10,-100]},d.createElement("planeBufferGeometry",{attach:"geometry",args:[1e3,300]}),d.createElement("meshPhysicalMaterial",{attach:"material",specular:"white",roughness:.3,reflectivity:1,metalness:.5,clearcoat:1,clearcoatRoughness:.15,color:U,side:v}))},Y=e=>d.createElement("mesh",{rotation:[z(0),0,0],position:[0,0,-200]},d.createElement("planeBufferGeometry",{attach:"geometry",args:[1e3,20]}),d.createElement("meshBasicMaterial",{color:"#356375"})),Z=e=>{const[t]=M((()=>c({rotation:[-Math.PI/2,0,0],position:[0,-10,0]},e)));return d.createElement("mesh",{ref:t},d.createElement("planeBufferGeometry",{attach:"geometry",args:[1e3,1e3]}),d.createElement("meshLambertMaterial",{attach:"material",color:U}))},H=e=>(console.log("Scene"),d.createElement(d.Fragment,null,d.createElement(w,{gravity:[0,0,0],iterations:20,defaultContactMaterial:{friction:.9,restitution:.7,contactEquationStiffness:1e7,contactEquationRelaxation:1,frictionEquationStiffness:1e7,frictionEquationRelaxation:2},tolerance:.001},d.createElement(N,null),d.createElement(X,null),d.createElement(I,{color:"#e07e28"}),d.createElement(j,{position:[5,0,0],size:.75}),d.createElement(j,{position:[6,2,0],size:.25}),d.createElement(j,{position:[6,2,0],size:.25}),d.createElement(j,{position:[6,2,0],size:.25}),d.createElement(j,{position:[6,2,0],size:.2}),d.createElement(j,{position:[6,2,0],size:.15}),d.createElement(j,{position:[6,2,0],size:.35}),d.createElement(j,{position:[6,2,0],size:.25}),d.createElement(j,{position:[-2,-5,0]}),d.createElement(j,{position:[-3,-3,0],size:1.2}),d.createElement(j,{position:[-7,-5,0],size:.8}),d.createElement(W,null),d.createElement(D,null),d.createElement(Y,null),d.createElement(Z,null)))),K=e=>(console.log("Controls"),l.exports.useEffect((()=>{const{controls:e}=P,t=t=>{38===t.keyCode||87===t.keyCode||32===t.keyCode?e.up=!0:37===t.keyCode||65===t.keyCode?e.left=!0:39===t.keyCode||68===t.keyCode?e.right=!0:40===t.keyCode||83===t.keyCode?e.down=!0:t.keyCode},o=t=>{38===t.keyCode||87===t.keyCode||32===t.keyCode?e.up=!1:37===t.keyCode||65===t.keyCode?e.left=!1:39===t.keyCode||68===t.keyCode?e.right=!1:40===t.keyCode||83===t.keyCode?e.down=!1:t.keyCode},r=()=>{e.mouse=!0},a=()=>{e.mouse=!1};return window.addEventListener("keydown",t),window.addEventListener("keyup",o),window.addEventListener("mousedown",r),window.addEventListener("mouseup",a),window.addEventListener("touchstart",r),window.addEventListener("touchend",a),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",r),window.removeEventListener("mouseup",a),window.removeEventListener("touchstart",r),window.removeEventListener("touchend",a)}}),[]),u((e=>{const{mouse:t,viewport:o}=e,r=t.x*o.width/2,a=t.y*o.height/2;P.mousePosition=[r,a,0]})),null),V=()=>{console.log("lighting");const e=l.exports.useRef();return u((()=>{const{isUnderWater:t}=P;e.current.intensity=x.lerp(e.current.intensity,t?.1:2,.1)})),d.createElement(d.Fragment,null,d.createElement("ambientLight",{ref:e,intensity:.1,color:"white"}),d.createElement("spotLight",{position:[0,200,-300],angle:.3,intensity:10,distance:500,decay:3,penumbra:1,color:"white"}))};function J({count:e,mouse:t}){const o=l.exports.useRef(),r=l.exports.useMemo((()=>new y),[]),a=l.exports.useMemo((()=>{const t=[];for(let o=0;o<e;o++){const e=100*Math.random(),o=10+Math.random(),r=.01,a=200*Math.random()-100,n=12*Math.random()-10,s=150*Math.random()-100;t.push({t:e,factor:o,speed:r,xFactor:a,yFactor:n,zFactor:s,mx:0,my:0})}return t}),[e]);return u((e=>{a.forEach(((t,a)=>{let{t:n,factor:s,speed:c,xFactor:i,yFactor:l,zFactor:m}=t;n=t.t+=.5*c,t.mx+=.001*(0-t.mx),t.my+=.001*(-0-t.my),r.position.set(t.mx/10*1+i+Math.cos(.05*e.clock.elapsedTime)+10*Math.sin(.05*e.clock.elapsedTime),t.my/10+l+Math.sin(.01*n*s)+Math.cos(.5*n)*s/10,m),r.updateMatrix(),o.current.setMatrixAt(a,r.matrix)})),o.current.instanceMatrix.needsUpdate=!0})),d.createElement(d.Fragment,null,d.createElement("instancedMesh",{ref:o,args:[null,null,e]},d.createElement("sphereGeometry",{args:[.05]}),d.createElement("meshLambertMaterial",{attach:"material",color:"#275e5c"})))}const Q=b.div`
  width: 100vw;
  height: 100vh;
  user-select: none;
`,$=()=>(console.log("Camera movement"),u((e=>{const[t,o,r]=P.position,[a,n,s]=P.velocity,c=t+.1*a,i=o+.1*n;e.camera.lookAt(c,i,0),e.camera.position.y=i>11?11:i>-9?i:-9,e.camera.position.x=c,e.camera.position.z=20,e.camera.updateProjectionMatrix()})),null),_=()=>(console.log("Scene mounted"),d.createElement(Q,null,d.createElement(S,{colorManagement:!0,camera:{position:[0,0,20],fov:45,far:230,near:.1}},d.createElement(l.exports.Suspense,{fallback:null},d.createElement(k,{preset:"forest"})),d.createElement(l.exports.Suspense,{fallback:null},d.createElement(V,null),d.createElement(H,null),d.createElement(L,{azimuth:0,turbidity:5,rayleigh:0,inclination:.8,sunPosition:[.1,5,-5],distance:1e4}),d.createElement(J,{count:1e3,mouse:{current:[0,0]}})),d.createElement("fog",{attach:"fog",args:[B,0,200]}),d.createElement($,null),d.createElement(K,null),d.createElement(R,{showPanel:0,className:"stats"}))));C.render(d.createElement(d.StrictMode,null,d.createElement(_,null)),document.getElementById("root"));
