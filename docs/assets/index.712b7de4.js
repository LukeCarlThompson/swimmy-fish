var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,c=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&s(e,r,t[r]);if(o)for(var r of o(t))a.call(t,r)&&s(e,r,t[r]);return e};import{u as i,r as l,V as m,a as u,l as p,R as d,b as h,S as f,C as E,c as y,M as g,O as w,d as x,T as M,P as v,e as b,s as S,f as k,E as L,g as R,h as C,i as P}from"./vendor.f3917c7f.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const A={position:[0,0,0],velocity:[0,0,0],rotation:[0,0,0],mousePosition:[0,0,0],controls:{up:!1,down:!1,left:!1,right:!1,mouse:!1},isUnderWater:!0,damping:.75,uuid:"",cannonApi:null},z=e=>e*(Math.PI/180),F=e=>e/(1+Math.abs(e)),I=(e,t=2)=>Number(e.toFixed(t)),G=e=>d.createElement("meshPhysicalMaterial",{attach:"material",flatShading:!1,specular:"#ffffff",roughness:.7,reflectivity:.3,metalness:.5,clearcoat:1,clearcoatRoughness:.2,color:e.color||"purple"}),O=e=>{const t=l.exports.useRef(),r=l.exports.useRef(),o=l.exports.useRef(),{abs:n,sin:a}=Math;return console.log("Tail"),u((e=>{const{velocity:s,position:c}=A,[i,l,m]=s,[u,p,d]=c,h=z(a(n(l)+n(p)+n(i)+n(u)+4*e.clock.getElapsedTime()));t.current.rotation.set(0,10*h,0),r.current.rotation.set(0,25*h,0),o.current.rotation.set(0,25*h,0)})),d.createElement("group",{ref:t,name:"tail"},d.createElement(h,{args:[1,.75,.6],position:[-.5,.05,0],radius:.2,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(G,{color:e.color})),d.createElement("group",{ref:r,position:[-1,0,0]},d.createElement(h,{args:[.6,.6,.3],position:[-.1,0,0],radius:.05,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(G,{color:e.color})),d.createElement("group",{ref:o,position:[-.4,0,0]},d.createElement(h,{args:[.75,.4,.1],position:[-.1,.15,0],radius:.05,smoothness:4,rotation:[0,0,-10],receiveShadow:!0,castShadow:!0},d.createElement(G,{color:e.color})),d.createElement(h,{args:[.75,.4,.1],position:[-.1,-.15,0],radius:.05,smoothness:4,rotation:[0,0,10],receiveShadow:!0,castShadow:!0},d.createElement(G,{color:e.color})))))},T=e=>{const o=l.exports.useRef(),n=new m;return u((t=>{const[r,a,s]=A.velocity,c=n.set(F(-.1*a),.1*F(-1*a)+.5,0);o.current.setRotationFromAxisAngle(c.normalize(),e.mirror?-10:.5)})),d.createElement("group",(a=c({},e),t(a,r({ref:o,name:"eyeball"}))),d.createElement(f,{position:[0,0,0],args:[.3],receiveShadow:!0,castShadow:!0},d.createElement(G,{translate:[0,10,.25],attach:"material",color:"#f3f3f3"})),d.createElement(f,{position:[0,0,.25],args:[.1],receiveShadow:!0,castShadow:!0},d.createElement(G,{translate:[0,10,.25],attach:"material",color:"black"})));var a},U=e=>{const[t,r]=i((()=>c({mass:1,position:[0,0,0],linearDamping:.75,linearFactor:[1,1,0],angularFactor:[1,1,0],allowSleep:!1},e))),o=l.exports.useRef(),n=l.exports.useRef(),a=new m,{abs:s,sin:f,atan2:E}=Math,y=l.exports.useRef({x:[0],y:[0]}),g=l.exports.useRef({x:[0],y:[0]});console.log("Player"),l.exports.useLayoutEffect((()=>{A.uuid=t.current.uuid,A.cannonApi=r,console.count("subscribed");const e=r.velocity.subscribe((e=>{A.velocity=e,y.current.x.push(e[0]),y.current.x.length>10&&y.current.x.shift(),y.current.y.push(e[1]),y.current.y.length>10&&y.current.y.shift()})),o=r.position.subscribe((e=>{A.position=e,g.current.x.push(e[0]),g.current.x.length>10&&g.current.x.shift(),g.current.y.push(e[1]),g.current.y.length>10&&g.current.y.shift()})),n=r.rotation.subscribe((e=>{A.rotation=e})),a=r.linearDamping.subscribe((e=>{A.damping=e}));return()=>{console.count("unsubscribed"),e(),o(),n(),a()}}),[]);const w=e=>{const t=e.slice().sort(((e,t)=>e-t)),r=Math.floor(t.length/2);return t.length%2==0?(t[r-1]+t[r])/2:t[r]};return u((e=>{let{controls:t,isUnderWater:c,position:i,rotation:l,velocity:m,mousePosition:u,damping:d}=A;const[h,E,x]=m,[M,v]=u,[b,S,k]=i;t.up&&c&&r.applyImpulse([0,.4,0],[0,0,0]),t.down&&c&&r.applyImpulse([0,-.4,0],[0,0,0]),t.right&&c&&r.applyImpulse([.4,0,0],[0,0,0]),t.left&&c&&r.applyImpulse([-.4,0,0],[0,0,0]),t.mouse&&c&&r.applyImpulse([.1*M,.1*v,0],[0,0,0]);const L=(c&&E)<-10?.99:c?.75:.01;r.linearDamping.set(p(d,L,.5)),!c&&S>10.25&&r.applyImpulse([0,-.5,0],[0,0,0]),S<9&&!c&&(c=!0),S<-9&&r.applyImpulse([0,.05,0],[0,0,0]),s(b)>100&&r.applyImpulse([-.01*b,0,0],[0,0,0]);const R=w(g.current.x),C=w(g.current.y),P=w(y.current.x),G=w(y.current.y),O=s(G)+s(C)+s(P)+s(R),T=-10*f(O+4*e.clock.getElapsedTime()),U={y:I(180*(.5*F(.5*P)-.5)+T),z:I(90*F(.2*G))};r.rotation.set(0,z(U.y),z(U.z)),o.current.setRotationFromAxisAngle(a.lerp(a.set(F(1*E),-1,0),.25),.5),n.current.setRotationFromAxisAngle(a.lerp(a.set(-1*F(1*E),1,0),.25),.5)})),d.createElement("group",{ref:t,name:"player"},d.createElement(h,{args:[1.5,1.2,.8],position:[.25,.1,0],radius:.2,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(G,{color:e.color})),d.createElement(h,{args:[.7,.5,.8],position:[.8,-.25,0],rotation:[0,0,0],radius:.2,smoothness:6,receiveShadow:!0,castShadow:!0},d.createElement(G,{color:e.color})),d.createElement(h,{args:[.5,.5,.05],name:"dorsal-fin",position:[.25,.7,0],radius:.05,smoothness:4,rotation:[0,0,10],receiveShadow:!0,castShadow:!0},d.createElement(G,{color:e.color})),d.createElement(h,{ref:o,name:"right-fin",args:[.5,.1,.6],position:[-0,-.25,.4],radius:.05,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(G,{color:e.color})),d.createElement(h,{ref:n,name:"left-fin",args:[.5,.1,.6],position:[-0,-.25,-.4],radius:.05,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(G,{color:e.color})),d.createElement(h,{name:"lips",args:[.1,.1,.5],position:[1.11,-.3,0],radius:.05,smoothness:4,receiveShadow:!0,castShadow:!0},d.createElement(G,{color:"#2e2929"})),d.createElement(T,{position:[.6,.1,.35]}),d.createElement(T,{position:[.6,.1,-.35],mirror:!0}),d.createElement(O,{color:e.color}))},j=e=>{const t=l.exports.useRef(),r=l.exports.useRef(!1),o=l.exports.useRef(new E("hsl(50, 75%, 50%)")),n=l.exports.useRef(new E("hsl(190, 63%, 38%)")),a=e.size||.5,[s,i]=y((()=>c({mass:.2*a,position:e.position,linearDamping:.7,linearFactor:[1,1,0],args:[a],allowSleep:!0,sleepSpeedLimit:.25,onCollide:e=>{r.current=!r.current}},e)));return u((({clock:e})=>{r.current?t.current.color.lerpHSL(n.current,.05):t.current.color.lerpHSL(o.current,.05)})),console.log("Ball"),d.createElement("group",{ref:s},d.createElement(f,{position:[0,0,0],args:[a],receiveShadow:!0,castShadow:!0},d.createElement(g,{ref:t,attach:"material",color:"hsl(340, 88%, 60%)",metalness:1,specular:"#0068b3",roughness:.7,reflectivity:.5,clearcoat:.5,clearcoatRoughness:.2})))},B="#4898e8",N="#164f6e",W=e=>(console.log("Sphere"),d.createElement(d.Fragment,null,d.createElement("sphereGeometry",{args:8*(.5*Math.random()+.75)}),d.createElement("meshLambertMaterial",{attach:"material",color:N}))),D=e=>{const t=l.exports.useRef(),r=l.exports.useRef(Array.from(Array(20)).map((e=>[Math.random()-.5,Math.random(),Math.random()]))),o=l.exports.useRef(new w),n=l.exports.useRef(r.current.map(((e,t)=>({positionX:100*e[0],positionZ:-100*e[1]+10,rotationY:e[2]}))),[]);return l.exports.useLayoutEffect((()=>{n.current.forEach(((e,r)=>{const{positionX:n,positionZ:a,rotationY:s}=e,c=.5*Math.random()+.5;o.current.position.set(n*(Math.random()+.5),-15,a*(Math.random()+.75)),o.current.scale.set(1,c,1),o.current.updateMatrix(),t.current.setMatrixAt(r,o.current.matrix)})),t.current.instanceMatrix.needsUpdate=!0}),[]),d.createElement("group",null,d.createElement("instancedMesh",{ref:t,args:[null,null,n.current.length]},d.createElement(W,null)),d.createElement("mesh",{position:[-30,-13,-100],rotation:[0,0,0]},d.createElement("icosahedronGeometry",{args:25}),d.createElement("meshLambertMaterial",{attach:"material",color:N})),d.createElement("mesh",{position:[-40,-15,-40],rotation:[10*Math.random(),10*Math.random(),10*Math.random()]},d.createElement("icosahedronGeometry",{args:15}),d.createElement("meshLambertMaterial",{attach:"material",color:N})),d.createElement("mesh",{position:[10,-10,-10],rotation:[10*Math.random(),10*Math.random(),10*Math.random()]},d.createElement("icosahedronGeometry",{args:5}),d.createElement("meshLambertMaterial",{attach:"material",color:N})),d.createElement("mesh",{position:[20,-10,-25],rotation:[10*Math.random(),10*Math.random(),10*Math.random()]},d.createElement("dodecahedronGeometry",{args:5}),d.createElement("meshLambertMaterial",{attach:"material",color:N})))};const X=e=>{console.log("Plane");const t=x(M,"/swimmy-fish/assets/seaweed-100w.344c6dd9.png");return t.offset.set(0,-1),t.repeat.set(1,2),d.createElement(d.Fragment,null,d.createElement("planeGeometry",{args:[3,12]}),d.createElement("meshLambertMaterial",{attach:"material",color:N,transparent:!0,alphaTest:.5,map:t}))},Y=e=>{const t=l.exports.useRef(Array.from(Array(200)).map((e=>[Math.random()-.5,Math.random(),Math.random()]))),r=l.exports.useRef(),o=l.exports.useRef(new w),n=l.exports.useRef(t.current.map(((e,t)=>({positionX:100*e[0],positionZ:-100*e[1]+10,rotationY:e[2]}))),[]);l.exports.useLayoutEffect((()=>{n.current.forEach(((e,t)=>{const{positionX:n,positionZ:a,rotationY:s}=e,c=2*Math.random();e.position=[n,-10,a>-1&&a<2?a:a-100*Math.random()],o.current.position.set(...e.position),e.scale=[c,c,1],o.current.scale.set(...e.scale),o.current.updateMatrix(),r.current.setMatrixAt(t,o.current.matrix)})),r.current.instanceMatrix.needsUpdate=!0}),[]);const{sin:a}=Math;return u((e=>{n.current.forEach(((t,n)=>{const s=.1*a(e.clock.elapsedTime+.03*t.position[0]);o.current.scale.set(...t.scale),o.current.position.set(...t.position),o.current.rotation.set(1*s,-2*s,s),o.current.updateMatrix(),r.current.setMatrixAt(n,o.current.matrix)})),r.current.instanceMatrix.needsUpdate=!0})),d.createElement("instancedMesh",{ref:r,args:[null,null,n.current.length]},d.createElement(X,null))},Z=e=>{const[t]=b((()=>c({rotation:[-Math.PI/2,0,0],position:[0,10,0],isTrigger:!0,onCollide:e=>{const{body:t}=e,r=A.uuid;t.uuid===r&&(A.isUnderWater=!0)}},e)));return console.log("Water surface"),d.createElement("mesh",{ref:t},d.createElement("planeBufferGeometry",{attach:"geometry",args:[1e3,1e3]}),d.createElement("meshBasicMaterial",{attach:"material",color:"#303d75",transparent:!0,opacity:.25}))},q=e=>{const[t]=b((()=>c({rotation:[-Math.PI/-2,0,0],position:[0,10,-125],isTrigger:!0,onCollide:e=>{const{body:t,contact:r}=e,o=A.uuid,n=A.cannonApi,{velocity:a}=A;t.uuid===o&&(A.isUnderWater=!1,n.applyImpulse([.2*a[0],.2*a[1],0],[0,0,0]))}},e))),r=x(M,"/swimmy-fish/assets/caustics-bw.dd31a2b8.png");return r.offset.set(0,1),r.repeat.set(100,30),console.log("emissiveMap --\x3e",r),u((({clock:e})=>{const{geometry:r}=t.current,{position:o}=r.attributes,n=o.array.map(((t,r)=>(r-2)%3==0?t+.01*Math.sin((o.array[r+1]*r||0)+e.getElapsedTime()):t));o.array=n,o.needsUpdate=!0,r.computeVertexNormals()})),console.log("Ceiling"),d.createElement("mesh",{ref:t,position:[0,10,-100]},d.createElement("planeBufferGeometry",{attach:"geometry",args:[800,300,80,30]}),d.createElement("meshPhongMaterial",{shininess:100,color:"#587fad",emissive:"#9aede5",emissiveMap:r,emissiveIntensity:.75,side:2}))},H=e=>d.createElement("mesh",{rotation:[z(0),0,0],position:[0,0,-200]},d.createElement("planeBufferGeometry",{attach:"geometry",args:[1e3,20]}),d.createElement("meshBasicMaterial",{color:"#356375"})),V=e=>{const[t]=b((()=>c({rotation:[-Math.PI/2,0,0],position:[0,-10,0]},e)));return d.createElement("mesh",{ref:t},d.createElement("planeBufferGeometry",{attach:"geometry",args:[1e3,1e3]}),d.createElement("meshLambertMaterial",{attach:"material",color:N}))},K=e=>(console.log("Scene"),d.createElement(d.Fragment,null,d.createElement(v,{gravity:[0,0,0],broadphase:"SAP",defaultContactMaterial:{contactEquationRelaxation:4,friction:.001},allowSleep:!0},d.createElement(Z,null),d.createElement(q,null),d.createElement(U,{color:"#e07e28"}),d.createElement(j,{position:[5,0,0],size:.75}),d.createElement(j,{position:[6,2,0],size:.25}),d.createElement(j,{position:[6,2,0],size:.25}),d.createElement(j,{position:[6,2,0],size:.25}),d.createElement(j,{position:[6,2,0],size:.2}),d.createElement(j,{position:[6,2,0],size:.15}),d.createElement(j,{position:[6,2,0],size:.35}),d.createElement(j,{position:[6,2,0],size:.25}),d.createElement(j,{position:[-2,-5,0]}),d.createElement(j,{position:[-3,-3,0],size:1.2}),d.createElement(j,{position:[-7,-5,0],size:.8}),d.createElement(D,null),d.createElement(Y,null),d.createElement(H,null),d.createElement(V,null)))),J=e=>(console.log("Controls"),l.exports.useEffect((()=>{const{controls:e}=A,t=t=>{38===t.keyCode||87===t.keyCode||32===t.keyCode?e.up=!0:37===t.keyCode||65===t.keyCode?e.left=!0:39===t.keyCode||68===t.keyCode?e.right=!0:40===t.keyCode||83===t.keyCode?e.down=!0:t.keyCode},r=t=>{38===t.keyCode||87===t.keyCode||32===t.keyCode?e.up=!1:37===t.keyCode||65===t.keyCode?e.left=!1:39===t.keyCode||68===t.keyCode?e.right=!1:40===t.keyCode||83===t.keyCode?e.down=!1:t.keyCode},o=()=>{e.mouse=!0},n=()=>{e.mouse=!1};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),window.addEventListener("mousedown",o),window.addEventListener("mouseup",n),window.addEventListener("touchstart",o),window.addEventListener("touchend",n),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",r),window.removeEventListener("mousedown",o),window.removeEventListener("mouseup",n),window.removeEventListener("touchstart",o),window.removeEventListener("touchend",n)}}),[]),u((e=>{const{mouse:t,viewport:r}=e,o=t.x*r.width/2,n=t.y*r.height/2;A.mousePosition=[o,n,0]})),null),Q=()=>{console.log("lighting");const e=l.exports.useRef(),t=l.exports.useRef(),r=l.exports.useRef(new E);return u((()=>{const{isUnderWater:t}=A;e.current.intensity=p(e.current.intensity,t?.1:.5,.1),e.current.color.lerp(t?r.current.set("#ffffff"):r.current.set("#ffdb4a"),.1)})),d.createElement(d.Fragment,null,d.createElement("ambientLight",{ref:e,intensity:.1,color:"white"}),d.createElement("spotLight",{ref:t,position:[0,200,-300],angle:.3,intensity:10,distance:500,decay:3,penumbra:1,color:"white"}))};function $({count:e,mouse:t}){const r=l.exports.useRef(),{sin:o,cos:n,random:a}=Math,s=l.exports.useMemo((()=>new w),[]),c=l.exports.useMemo((()=>{const t=[];for(let r=0;r<e;r++){const e=100*a(),r=10+a(),o=.01,n=200*a()-100,s=12*a()-10,c=150*a()-100;t.push({t:e,factor:r,speed:o,xFactor:n,yFactor:s,zFactor:c,mx:0,my:0})}return t}),[e,a]);return u((e=>{c.forEach(((t,a)=>{let{t:c,factor:i,speed:l,xFactor:m,yFactor:u,zFactor:p}=t;c=t.t+=.5*l,t.mx+=.001*(0-t.mx),t.my+=.001*(-0-t.my),s.position.set(t.mx/10*1+m+n(.05*e.clock.elapsedTime)+10*o(.05*e.clock.elapsedTime),t.my/10+u+o(.01*c*i)+n(.5*c)*i/10,p),s.updateMatrix(),r.current.setMatrixAt(a,s.matrix)})),r.current.instanceMatrix.needsUpdate=!0})),d.createElement(d.Fragment,null,d.createElement("instancedMesh",{ref:r,args:[null,null,e]},d.createElement("sphereGeometry",{args:[.05]}),d.createElement("meshLambertMaterial",{attach:"material",color:"#275e5c"})))}const _=S.div`
  width: 100vw;
  height: 100vh;
  user-select: none;
`,ee=()=>(console.log("Camera movement"),u((e=>{const[t,r,o]=A.position,[n,a,s]=A.velocity,c=p(e.camera.position.x,t+.1*n,.7),i=r+.1*a>11?11:r+.1*a>-9?r+.1*a:-9,l=p(e.camera.position.y,i,.7),m=p(e.camera.position.y,r+.1*a,.7);e.camera.lookAt(c,m,0),e.camera.position.y=l,e.camera.position.x=c,e.camera.position.z=20,e.camera.updateProjectionMatrix()})),null),te=()=>(console.log("Scene mounted"),d.createElement(_,null,d.createElement(k,{mode:"concurrent",colorManagement:!0,camera:{position:[0,0,20],fov:45,far:230,near:.1}},d.createElement(l.exports.Suspense,{fallback:null},d.createElement(L,{files:"./blue-env-02.hdr"})),d.createElement(l.exports.Suspense,{fallback:null},d.createElement(Q,null),d.createElement(K,null),d.createElement(R,{azimuth:0,turbidity:5,rayleigh:0,inclination:.8,sunPosition:[.1,5,-5],distance:1e4}),d.createElement($,{count:1e3,mouse:{current:[0,0]}})),d.createElement("fog",{attach:"fog",args:[B,0,200]}),d.createElement(ee,null),d.createElement(J,null),d.createElement(C,{showPanel:0,className:"stats"}))));P.render(d.createElement(d.StrictMode,null,d.createElement(te,null)),document.getElementById("root"));
