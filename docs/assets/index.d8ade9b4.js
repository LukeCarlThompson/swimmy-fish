var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,c=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&s(e,r,t[r]);if(a)for(var r of a(t))n.call(t,r)&&s(e,r,t[r]);return e};import{u as i,r as l,V as m,a as u,l as p,R as d,b as h,S as f,C as y,M as E,O as g,c as w,T as M,P as x,d as v,s as b,e as S,f as k,E as R,g as C,h as L}from"./vendor.7f6dea2e.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const A={position:[0,0,0],velocity:[0,0,0],rotation:[0,0,0],mousePosition:[0,0,0],controls:{up:!1,down:!1,left:!1,right:!1,mouse:!1},isUnderWater:!0,damping:.75,uuid:"",cannonApi:null},P=e=>e*(Math.PI/180),F=e=>e/(1+Math.abs(e)),I={fogColor:"#4898e8",groundBaseColor:"#164f6e",waterHeight:10},B=e=>{const t=l.exports.useRef();return u((()=>{const{position:e}=A;t.current.envMapIntensity=e[1]>0?1:1+.1*e[1],t.current.clearcoat=e[1]>0?1:1+.1*e[1],t.current.reflectivity=e[1]>0?.3:.3+.1*e[1],t.current.roughness=e[1]>-3?.7:.7-.1*e[1]})),d.createElement("meshPhysicalMaterial",{ref:t,attach:"material",flatShading:!1,specular:"#ffffff",roughness:.7,reflectivity:.3,metalness:.5,clearcoat:1,clearcoatRoughness:.2,color:e.color||"purple"})},T=e=>{const t=l.exports.useRef(),r=l.exports.useRef(),a=l.exports.useRef(),{abs:o,sin:n}=Math;return u(((e,s)=>{const{velocity:c,position:i}=A,[l,m,u]=c,[p,d,h]=i,f=P(n(o(m)+o(d)+o(l)+o(p)+4*e.clock.getElapsedTime()));t.current.rotation.set(0,10*f,0),r.current.rotation.set(0,25*f,0),a.current.rotation.set(0,25*f,0)})),d.createElement("group",{ref:t,name:"tail"},d.createElement(h,{args:[1,.75,.6],position:[-.5,.05,0],radius:.2,smoothness:2,receiveShadow:!0,castShadow:!0},d.createElement(B,{color:e.color})),d.createElement("group",{ref:r,position:[-1,0,0]},d.createElement(h,{args:[.6,.6,.3],position:[-.1,0,0],radius:.05,smoothness:2,receiveShadow:!0,castShadow:!0},d.createElement(B,{color:e.color})),d.createElement("group",{ref:a,position:[-.4,0,0]},d.createElement(h,{args:[.75,.4,.1],position:[-.1,.15,0],radius:.05,smoothness:2,rotation:[0,0,-10],receiveShadow:!0,castShadow:!0},d.createElement(B,{color:e.color})),d.createElement(h,{args:[.75,.4,.1],position:[-.1,-.15,0],radius:.05,smoothness:2,rotation:[0,0,10],receiveShadow:!0,castShadow:!0},d.createElement(B,{color:e.color})))))},z=e=>{const a=l.exports.useRef(),o=new m;return u((t=>{const[r,n,s]=A.velocity,c=o.set(F(-.1*n),.1*F(-1*n)+.5,0);a.current.setRotationFromAxisAngle(c.normalize(),e.mirror?-10:.5)})),d.createElement("group",(n=c({},e),t(n,r({ref:a,name:"eyeball"}))),d.createElement(f,{position:[0,0,0],args:[.3],receiveShadow:!0,castShadow:!0},d.createElement(B,{translate:[0,10,.25],attach:"material",color:"#f3f3f3"})),d.createElement(f,{position:[0,0,.25],args:[.1],receiveShadow:!0,castShadow:!0},d.createElement(B,{translate:[0,10,.25],attach:"material",color:"black"})));var n},O=e=>{const[t,r]=i((()=>c({mass:1,position:[0,0,0],linearDamping:.75,linearFactor:[1,1,0],angularFactor:[0,0,0],args:[1],allowSleep:!1},e))),a=l.exports.useRef(),o=l.exports.useRef(),n=l.exports.useRef(),s=new m,{abs:f,sin:y,atan2:E}=Math;return l.exports.useLayoutEffect((()=>{A.uuid=t.current.uuid,A.cannonApi=r;const e=r.velocity.subscribe((e=>{A.velocity=e})),a=r.position.subscribe((e=>{A.position=e})),o=r.linearDamping.subscribe((e=>{A.damping=e}));return()=>{e(),a(),o()}}),[]),u(((e,t)=>{let{controls:c,isUnderWater:i,position:l,velocity:m,mousePosition:u,damping:d}=A;const[h,g,w]=m,[M,x]=u,[v,b,S]=l;A.isUnderWater=!(b>I.waterHeight),i&&(c.up&&r.applyImpulse([0,.4,0],[0,0,0]),c.down&&r.applyImpulse([0,-.4,0],[0,0,0]),c.right&&r.applyImpulse([.4,0,0],[0,0,0]),c.left&&r.applyImpulse([-.4,0,0],[0,0,0]),c.mouse&&r.applyImpulse([.1*M,.1*x,0],[0,0,0]));const k=(i&&g)<-10?.99:i?.75:.01;r.linearDamping.set(p(d,k,.5)),!i&&b>10.25&&r.applyImpulse([0,-.5,0],[0,0,0]),b<-8&&r.applyImpulse([0,.05,0],[0,0,0]),f(v)>100&&r.applyImpulse([-.01*v,0,0],[0,0,0]);const R=f(g)+f(b)+f(h)+f(v),C=-10*y(R+4*e.clock.getElapsedTime()),L={y:180*(.5*F(.5*h)-.5)+C,z:90*F(.2*g)},{rotation:B}=n.current;A.rotation=[B.x,B.y,B.z];const T=f(M)<3?E(M,f(x))-.5*Math.PI:P(M>0?1:-179),z=E(x,f(M)),O=p(B.y,c.mouse&i?T+P(C):P(L.y),10*t),U=p(B.z,c.mouse&i?z:P(L.z),5*t);n.current.rotation.set(0,O,U),a.current.setRotationFromAxisAngle(s.lerp(s.set(F(1*g),-1,0),.25),.5),o.current.setRotationFromAxisAngle(s.lerp(s.set(-1*F(1*g),1,0),.25),.5)})),d.createElement("group",{ref:t,name:"player-physics-object"},d.createElement("group",{ref:n,name:"player-body-group"},d.createElement(h,{name:"player-body-main",args:[1.5,1.2,.8],position:[.25,.1,0],radius:.2,smoothness:2,receiveShadow:!0,castShadow:!0},d.createElement(B,{color:e.color})),d.createElement(h,{name:"player-body-mouth",args:[.7,.5,.8],position:[.8,-.25,0],rotation:[0,0,0],radius:.2,smoothness:2,receiveShadow:!0,castShadow:!0},d.createElement(B,{color:e.color})),d.createElement(h,{name:"player-dorsal-fin",args:[.5,.5,.05],position:[.25,.7,0],radius:.05,smoothness:2,rotation:[0,0,10],receiveShadow:!0,castShadow:!0},d.createElement(B,{color:e.color})),d.createElement(h,{ref:a,name:"player-left-fin",args:[.5,.1,.6],position:[-0,-.25,.4],radius:.05,smoothness:2,receiveShadow:!0,castShadow:!0},d.createElement(B,{color:e.color})),d.createElement(h,{ref:o,name:"player-right-fin",args:[.5,.1,.6],position:[-0,-.25,-.4],radius:.05,smoothness:2,receiveShadow:!0,castShadow:!0},d.createElement(B,{color:e.color})),d.createElement(h,{name:"player-lips",args:[.1,.1,.5],position:[1.11,-.3,0],radius:.05,smoothness:2,receiveShadow:!0,castShadow:!0},d.createElement(B,{color:"#2e2929"})),d.createElement(z,{name:"player-left-eye",position:[.6,.1,.35]}),d.createElement(z,{name:"player-right-eye",position:[.6,.1,-.35],mirror:!0}),d.createElement(T,{name:"player-tail-group",color:e.color})))},U=e=>{const t=l.exports.useRef(),r=l.exports.useRef(!1),a=l.exports.useRef(new y("hsl(228, 90%, 50%)")),o=l.exports.useRef(new y("hsl(342, 80%, 37%)")),n=e.size||.5,[s,m]=i((()=>c({mass:.2*n,position:e.position,linearDamping:.7,linearFactor:[1,1,0],args:[n],allowSleep:!0,sleepSpeedLimit:.25,onCollide:e=>{r.current=!r.current}},e)));return u((({clock:e})=>{r.current?t.current.color.lerpHSL(o.current,.05):t.current.color.lerpHSL(a.current,.05)})),d.createElement("group",{ref:s},d.createElement(f,{position:[0,0,0],args:[n],receiveShadow:!0,castShadow:!0},d.createElement(E,{ref:t,attach:"material",color:"hsl(340, 88%, 60%)",metalness:1,specular:"#0068b3",roughness:.7,reflectivity:.5,clearcoat:.5,clearcoatRoughness:.2})))};var j="/swimmy-fish/assets/rock-surface-texture.f82e8530.png",G="/swimmy-fish/assets/rock-surface-normalmap.f2aa5bfb.png";const H=e=>{const t=w(M,j),r=w(M,G);return d.createElement(d.Fragment,null,d.createElement("sphereGeometry",{args:6*(.5*Math.random()+.75)}),d.createElement("meshPhongMaterial",{attach:"material",color:I.groundBaseColor,shininess:0,map:t,displacementMap:r,displacementScale:2,displacementBias:0,normalMap:r,normalScale:[.2,.2],roughnessMap:t}))},X=e=>{const t=l.exports.useRef(),r=l.exports.useRef(Array.from(Array(10)).map((e=>[Math.random()-.5,Math.random(),Math.random()]))),a=l.exports.useRef(new g),o=l.exports.useRef(r.current.map(((e,t)=>({positionX:300*e[0],positionZ:-100*e[1]-10,rotationY:e[2]}))),[]);return l.exports.useLayoutEffect((()=>{o.current.forEach(((e,r)=>{const{positionX:o,positionZ:n,rotationY:s}=e;a.current.rotation.set(-1,0,-.5),a.current.position.set(o*(Math.random()+.5),.05*Math.abs(o)-15,n),a.current.scale.set(1+.01*Math.abs(o),1+.01*Math.abs(o),1+.01*Math.abs(o)),a.current.updateMatrix(),t.current.setMatrixAt(r,a.current.matrix)})),t.current.instanceMatrix.needsUpdate=!0}),[]),d.createElement("group",null,d.createElement("instancedMesh",{ref:t,args:[null,null,o.current.length]},d.createElement(H,null)))};const Y=({number:e})=>{const t=w(M,"/swimmy-fish/assets/seaweed-03.744e9700.png");t.offset.set(0,-1),t.repeat.set(1,2);const r=l.exports.useRef(Array.from(Array(e)).map((e=>[Math.random()-.5,Math.random(),.5*Math.random()]))),a=l.exports.useRef(),o=l.exports.useRef(new g),n=l.exports.useRef(r.current.map(((e,t)=>({positionX:200*e[0],positionZ:-180*e[1]+10,rotationY:e[2]}))),[]);l.exports.useLayoutEffect((()=>{n.current.forEach(((e,t)=>{const{positionX:r,positionZ:n,rotationY:s}=e,c=Math.random()*Math.random()*2+.2;e.position=[r,-10,n-100*Math.sin(t)],o.current.position.set(...e.position),e.scale=[c,c,1],o.current.scale.set(...e.scale),o.current.updateMatrix(),a.current.setMatrixAt(t,o.current.matrix)})),a.current.instanceMatrix.needsUpdate=!0}),[]);const{sin:s}=Math;return u((e=>{n.current.forEach(((t,r)=>{const n=.1*s(e.clock.elapsedTime+.03*t.position[0]);o.current.scale.set(...t.scale),o.current.position.set(...t.position),o.current.rotation.set(1*n,-2*n,n),o.current.updateMatrix(),a.current.setMatrixAt(r,o.current.matrix)})),a.current.instanceMatrix.needsUpdate=!0})),d.createElement("instancedMesh",{ref:a,args:[null,null,n.current.length]},d.createElement("planeGeometry",{args:[6,6]}),d.createElement("meshLambertMaterial",{attach:"material",color:I.groundBaseColor,transparent:!0,alphaTest:.5,map:t}))},Z=e=>{const t=w(M,"/swimmy-fish/assets/seaweed-02.923a931a.png");return t.offset.set(0,-1),t.repeat.set(1,2),d.createElement(d.Fragment,null,d.createElement("planeGeometry",{args:[3,12]}),d.createElement("meshLambertMaterial",{attach:"material",color:I.groundBaseColor,transparent:!0,alphaTest:.5,map:t}))},D=e=>{const t=l.exports.useRef(Array.from(Array(e)).map(((e,t)=>[Math.sin(t)-.5,Math.random(),Math.random()]))),r=l.exports.useRef(),a=l.exports.useRef(new g),o=l.exports.useRef(t.current.map(((e,t)=>({positionX:200*e[0],positionZ:-180*e[1]+10,rotationY:e[2]}))),[]);l.exports.useLayoutEffect((()=>{o.current.forEach(((e,t)=>{const{positionX:o,positionZ:n,rotationY:s}=e,c=Math.random()*Math.random()*2+.2;e.position=[o,-10,n-100*Math.sin(t)],a.current.position.set(...e.position),e.scale=[c,c+(Math.random()-.5),1],a.current.scale.set(...e.scale),a.current.updateMatrix(),r.current.setMatrixAt(t,a.current.matrix)})),r.current.instanceMatrix.needsUpdate=!0}),[]);const{sin:n}=Math;return u((e=>{o.current.forEach(((t,o)=>{const s=.1*n(e.clock.elapsedTime+.03*t.position[0]);a.current.scale.set(...t.scale),a.current.position.set(...t.position),a.current.rotation.set(1*s,-2*s,s),a.current.updateMatrix(),r.current.setMatrixAt(o,a.current.matrix)})),r.current.instanceMatrix.needsUpdate=!0})),d.createElement("instancedMesh",{ref:r,args:[null,null,o.current.length]},d.createElement(Z,null))},N=({number:e})=>d.createElement(d.Fragment,null,d.createElement(D,{number:.5*e}),d.createElement(Y,{number:.5*e}));const W=e=>{const t=w(M,"/swimmy-fish/assets/rocks-02.56b2e4e4.png");return d.createElement("mesh",{position:[-10,-7,-130]},d.createElement("planeGeometry",{args:[400,18]}),d.createElement("meshLambertMaterial",{attach:"material",color:I.groundBaseColor,transparent:!0,alphaTest:.5,map:t}))},q=e=>{const t=w(M,"/swimmy-fish/assets/rocks-01.9aa0aff5.png");return d.createElement("mesh",{position:[25,-9,-80]},d.createElement("planeGeometry",{args:[20,10]}),d.createElement("meshLambertMaterial",{attach:"material",color:I.groundBaseColor,transparent:!0,alphaTest:.5,map:t}))},V=e=>d.createElement("group",null,d.createElement(q,null),d.createElement(W,null)),K=e=>{const[t]=v((()=>c({rotation:[-Math.PI/-2,0,0],position:[0,I.waterHeight,-125],isTrigger:!0,onCollide:e=>{const{body:t,contact:r}=e,a=A.uuid,o=A.cannonApi,{velocity:n}=A;t.uuid===a&&o.applyImpulse([.2*n[0],.2*n[1],0],[0,0,0])}},e))),r=w(M,"/swimmy-fish/assets/caustics-bw.dd31a2b8.png");return r.offset.set(0,1),r.repeat.set(100,30),u((({clock:e})=>{const{geometry:r}=t.current,{position:a}=r.attributes,o=a.array.map(((t,r)=>(r-2)%3==0?t+.01*Math.sin((a.array[r+1]*r||0)+e.getElapsedTime()):t));a.array=o,a.needsUpdate=!0,r.computeVertexNormals()})),d.createElement("mesh",{ref:t,position:[0,I.waterHeight,-100]},d.createElement("planeBufferGeometry",{attach:"geometry",args:[800,300,10,10]}),d.createElement("meshPhongMaterial",{shininess:100,color:"#587fad",emissive:"#9aede5",emissiveMap:r,emissiveIntensity:.75,side:2}))},J=e=>d.createElement("mesh",{rotation:[P(0),0,0],position:[0,0,-200]},d.createElement("planeBufferGeometry",{attach:"geometry",args:[1e3,30]}),d.createElement("meshBasicMaterial",{color:"#e3f6ff"})),Q=e=>{const[t]=v((()=>c({rotation:[-Math.PI/2,0,0],position:[0,-10,0]},e))),r=w(M,j),a=w(M,G);return d.createElement("mesh",{ref:t},d.createElement("planeBufferGeometry",{attach:"geometry",args:[1e3,1e3,50,50]}),d.createElement("meshPhongMaterial",{attach:"material",color:I.groundBaseColor,shininess:0,map:r,displacementMap:a,displacementScale:4,displacementBias:-2,normalMap:a,normalScale:[1,1],roughnessMap:r}))},$=e=>d.createElement(d.Fragment,null,d.createElement(x,{gravity:[0,0,0],broadphase:"SAP",defaultContactMaterial:{contactEquationRelaxation:4,friction:.001},allowSleep:!0},d.createElement(K,null),d.createElement(O,{color:"#e07e28"}),d.createElement(U,{position:[-3,-3,0],size:1.2}),d.createElement(X,null),d.createElement(N,{number:1e3}),d.createElement(V,null),d.createElement(J,null),d.createElement(Q,null))),_=e=>(l.exports.useEffect((()=>{const{controls:e}=A,t=t=>{38===t.keyCode||87===t.keyCode||32===t.keyCode?e.up=!0:37===t.keyCode||65===t.keyCode?e.left=!0:39===t.keyCode||68===t.keyCode?e.right=!0:40===t.keyCode||83===t.keyCode?e.down=!0:t.keyCode},r=t=>{38===t.keyCode||87===t.keyCode||32===t.keyCode?e.up=!1:37===t.keyCode||65===t.keyCode?e.left=!1:39===t.keyCode||68===t.keyCode?e.right=!1:40===t.keyCode||83===t.keyCode?e.down=!1:t.keyCode},a=()=>{e.mouse=!0},o=()=>{e.mouse=!1};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),window.addEventListener("mousedown",a),window.addEventListener("mouseup",o),window.addEventListener("touchstart",a),window.addEventListener("touchend",o),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",r),window.removeEventListener("mousedown",a),window.removeEventListener("mouseup",o),window.removeEventListener("touchstart",a),window.removeEventListener("touchend",o)}}),[]),u((e=>{const{mouse:t,viewport:r}=e,a=t.x*r.width/2,o=t.y*r.height/2;A.mousePosition=[a,o,0]})),null),ee=()=>{const e=l.exports.useRef(),t=l.exports.useRef(),r=l.exports.useRef(new y);return u((()=>{const{isUnderWater:t}=A;e.current.intensity=p(e.current.intensity,t?.1:.5,.1),e.current.color.lerp(t?r.current.set("#ffffff"):r.current.set("#ffdb4a"),.1)})),d.createElement(d.Fragment,null,d.createElement("ambientLight",{ref:e,intensity:.1,color:"white"}),d.createElement("spotLight",{ref:t,position:[0,200,-300],angle:.3,intensity:10,distance:500,decay:3,penumbra:1,color:"white"}))};function te({count:e}){const t=l.exports.useRef(),{sin:r,cos:a,random:o}=Math,n=l.exports.useMemo((()=>new g),[]),s=l.exports.useMemo((()=>{const t=[];for(let r=0;r<e;r++){const e=100*o(),r=10+o(),a=.01,n=200*o()-100,s=12*o()-10,c=150*o()-100;t.push({t:e,factor:r,speed:a,xFactor:n,yFactor:s,zFactor:c,mx:0,my:0})}return t}),[e,o]);return u(((e,o)=>{s.forEach(((o,s)=>{let{t:c,factor:i,speed:l,xFactor:m,yFactor:u,zFactor:p}=o;c=o.t+=.5*l,o.mx+=.001*(0-o.mx),o.my+=.001*(-0-o.my),n.position.set(o.mx/10*1+m+a(.05*e.clock.elapsedTime)+10*r(.05*e.clock.elapsedTime),o.my/10+u+r(.01*c*i)+a(.5*c)*i/10,p),n.updateMatrix(),t.current.setMatrixAt(s,n.matrix)})),t.current.instanceMatrix.needsUpdate=!0})),d.createElement(d.Fragment,null,d.createElement("instancedMesh",{ref:t,args:[null,null,e]},d.createElement("sphereGeometry",{args:[.05]}),d.createElement("meshLambertMaterial",{attach:"material",color:"#275e5c"})))}const re=b.div`
  width: 100vw;
  height: 100vh;
  user-select: none;
`,ae=()=>(console.log("Camera movement"),u(((e,t)=>{const[r,a,o]=A.position,[n,s,c]=A.velocity,i=p(e.camera.position.x,r+.1*n,.5),l=a+.1*s>11?11:a+.1*s>-9?a+.1*s:-9,m=p(e.camera.position.y,l,.5),u=p(e.camera.position.y,a+.1*s,.7);e.camera.lookAt(i,u,0),e.camera.position.y=m,e.camera.position.x=i,e.camera.position.z=20,e.camera.updateProjectionMatrix()})),null),oe=()=>{const e=l.exports.useRef(),{waterHeight:t,fogColor:r}=I;return u((({camera:r})=>{r.position.y>t?e.current.far=1e3:e.current.far=200})),d.createElement("fog",{ref:e,attach:"fog",args:[r,0,200]})},ne=()=>d.createElement(re,null,d.createElement(S,{mode:"concurrent",colorManagement:!0,camera:{position:[0,0,20],fov:45,far:230,near:.1}},d.createElement(k,{azimuth:0,turbidity:5,rayleigh:0,inclination:.8,sunPosition:[.1,5,-5],distance:1e4}),d.createElement(oe,null),d.createElement("color",{attach:"background",args:I.fogColor}),d.createElement(l.exports.Suspense,{fallback:null},d.createElement(R,{files:"./blue-env-02.hdr"}),d.createElement(ee,null),d.createElement($,null),d.createElement(te,{count:1e3})),d.createElement(ae,null),d.createElement(_,null),d.createElement(C,{showPanel:0,className:"stats"})));L.render(d.createElement(d.StrictMode,null,d.createElement(ne,null)),document.getElementById("root"));
